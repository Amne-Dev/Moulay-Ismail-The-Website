<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage - Moulay Ismail High School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="hamburger-menu" id="hamburgerMenu" title="Menu">
        <span class="hamburger-icon"></span>
        <span class="hamburger-icon"></span>
        <span class="hamburger-icon"></span>
    </button>

    <div class="container-fluid" id="english-version">
        <div class="row">
            <!-- Main Content -->
            <div class="col-md-9 offset-md-0">
                <div class="d-flex justify-content-between align-items-center p-3">
                    <div class="d-none d-md-block">
                        <button class="btn btn-outline-primary me-2">Homepage</button>
                        <a class="btn btn-outline-secondary" href="/AboutUs/">About us</a>
                    </div>
                </div>

                <!-- Hero Section -->
                <div class="text-center mt-5 logo" id="hero-section">
                    <img src="https://raw.githubusercontent.com/Amne-Dev/MyIsmail-Web/refs/heads/main/Images/299214068_488961346562688_7481375062274533520_n__1_-removebg-preview.png" alt="Logo" class="mb-3">
                    <p id="hero-subtitle">Moulay Ismail High School</p>
                    <h1 id="hero-title">Online Community of Teachers and Students</h1>
                </div>

                <!-- Slideshow -->
                <div id="slideshow" class="carousel slide mt-5" data-bs-ride="carousel">
                    <div class="carousel-inner" id="slideshow-content">
                        <!-- Default slides - will be replaced by dynamic content -->
                        <div class="carousel-item active">
                            <a href="https://example.com/slide1" target="_blank">
                                <img src="https://placehold.co/1200x800" class="d-block w-100" alt="Slide 1">
                            </a>
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Welcome to our Community</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <a href="https://example.com/slide2" target="_blank">
                                <img src="https://placehold.co/1200x800" class="d-block w-100" alt="Slide 2">
                            </a>
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Engage with Teachers and Students</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <a href="https://example.com/slide3" target="_blank">
                                <img src="https://placehold.co/1200x800" class="d-block w-100" alt="Slide 3">
                            </a>
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Collaborate and Learn Together</h5>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#slideshow" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#slideshow" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                    <div class="carousel-indicators" id="slideshow-indicators">
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="0" class="active" aria-current="true" title="Slide 1"></button>
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="1" title="Slide 2"></button>
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="2" title="Slide 3"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="Desktop-lg">
            <button class="btn btn-outline-primary me-2 d-md-none">Homepage</button>
            <a class="btn btn-outline-secondary d-md-none" href="/AboutUs/">About us</a>
            <div class="dropdown language-switch mt-3">
              <button class="btn btn-secondary dropdown-toggle languageDropdown" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  En
              </button>
              <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                  <li><a class="dropdown-item" href="#" id="switch-to-arabic">عربي</a></li>
                  <li><a class="dropdown-item" href="#" id="switch-to-english">English</a></li>
              </ul>
          </div>
        </div>

        <button><a href="/MyIsmail-Web/Projects" class="list-group-item list-group-item-action">Student's Project Work</a></button>
        <button><a href="/MyIsmail-Web/Lessons/" class="list-group-item list-group-item-action">Teacher's Lessons</a></button>
        <button><a href="/MyIsmail-Web/Activities" class="list-group-item list-group-item-action">School Activities</a></button>
        <button><a href="/MyIsmail-Web/Soon/" class="list-group-item list-group-item-action">Connecting Classrooms</a></button>
        <button><a href="/MyIsmail-Web/Soon/" class="list-group-item list-group-item-action">Sharing Experiences</a></button>
    </div>

    <div class="container-fluid" id="arabic-version" style="display: none;">
        <div class="row">
            <!-- Main Content -->
            <div class="col-md-9 offset-md-0">
                <div class="d-flex justify-content-between align-items-center p-3">
                    <div class="d-none d-md-block">
                        <button class="btn btn-outline-primary me-2">الرئيسية</button>
                        <button class="btn btn-outline-secondary">من نحن</button>
                    </div>
                </div>

                <!-- Hero Section Arabic -->
                <div class="text-center mt-5 logo" id="hero-section-arabic">
                    <img src="https://raw.githubusercontent.com/Amne-Dev/MyIsmail-Web/refs/heads/main/Images/299214068_488961346562688_7481375062274533520_n__1_-removebg-preview.png" alt="Logo" class="mb-3">
                    <p id="hero-subtitle-arabic">ثانوية مولاي إسماعيل</p>
                    <h1 id="hero-title-arabic">مجتمع تعليمي للمعلمين والطلاب عبر الإنترنت</h1>
                </div>

                <!-- Slideshow Arabic -->
                <div id="slideshow-arabic" class="carousel slide mt-5" data-bs-ride="carousel">
                    <div class="carousel-inner" id="slideshow-content-arabic">
                        <!-- Default slides - will be replaced by dynamic content -->
                        <div class="carousel-item active">
                            <a href="https://example.com/slide1" target="_blank">
                                <img src="https://placehold.co/1200x500" class="d-block w-100" alt="شريحة 1">
                            </a>
                            <div class="carousel-caption d-none d-md-block">
                                <h5>مرحبًا بكم في مجتمعنا</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <a href="https://example.com/slide2" target="_blank">
                                <img src="https://placehold.co/1200x800" class="d-block w-100" alt="شريحة 2">
                            </a>
                            <div class="carousel-caption d-none د-md-block">
                                <h5>تفاعل مع المعلمين والطلاب</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <a href="https://example.com/slide3" target="_blank">
                                <img src="https://placehold.co/1200x800" class="d-block w-100" alt="شريحة 3">
                            </a>
                            <div class="carousel-caption د-none д-md-block">
                                <h5>تعاون وتعلم معًا</h5>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#slideshow-arabic" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#slideshow-arabic" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                    <div class="carousel-indicators" id="slideshow-indicators-arabic">
                        <button type="button" data-bs-target="#slideshow-arabic" data-bs-slide-to="0" class="active" aria-current="true" title="شريحة 1"></button>
                        <button type="button" data-bs-target="#slideshow-arabic" data-bs-slide-to="1" title="شريحة 2"></button>
                        <button type="button" data-bs-target="#slideshow-arabic" data-bs-slide-to="2" title="شريحة 3"></button>
                    </div>
                </div>
            </div>

            <!-- Sidebar Arabic -->
            <div class="sidebar" id="sidebar-arabic">
                <div class="Desktop-lg">
                    <button class="btn btn-outline-primary me-2 d-md-none">الرئيسية</button>
                    <button class="btn btn-outline-secondary d-md-none">من نحن</button>

                    <div class="dropdown language-switch mt-3">
                      <button class="btn btn-secondary dropdown-toggle languageDropdown" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                          En
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="languageDropdown">
                          <li><a class="dropdown-item" href="#" id="switch-to-arabic-ar">عربي</a></li>
                          <li><a class="dropdown-item" href="#" id="switch-to-english-ar">English</a></li>
                      </ul>
                  </div>

                </div>
                <button><a href="/MyIsmail-Web/Projects" class="list-group-item list-group-item-action">مشاريع الطلاب</a></button>
                <button><a href="/MyIsmail-Web/Lessons" class="list-group-item list-group-item-action">دروس الأساتدة</a></button>
                <button><a href="/MyIsmail-Web/Activities" class="list-group-item list-group-item-action">الأنشطة المدرسية</a></button>
                <button><a href="/MyIsmail-Web/Soon" class="list-group-item list-group-item-action">ربط الفصول الدراسية</a></button>
                <button><a href="/MyIsmail-Web/Soon" class="list-group-item list-group-item-action">مشاركة التجارب</a></button>      

            </div>
        </div>
    </div>

    <!-- Inline Main Script -->
    <script>
    // Main script for homepage dynamic content
    const API_BASE = window.location.origin + '/api';

    // Content management
    class ContentManager {
        constructor() {
            this.currentLanguage = 'en';
            this.content = {
                hero: [],
                slideshow: []
            };
        }

        // Fetch content from API
        async fetchContent(section = null, language = 'en') {
            try {
                const params = new URLSearchParams({
                    language: language,
                    ...(section && { section })
                });
                
                const response = await fetch(`${API_BASE}/content?${params}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching content:', error);
                return [];
            }
        }

        // Load and render hero content
        async loadHeroContent(language = 'en') {
            try {
                const heroContent = await this.fetchContent('hero', language);
                this.renderHeroContent(heroContent, language);
            } catch (error) {
                console.error('Error loading hero content:', error);
            }
        }

        // Render hero section
        renderHeroContent(content, language) {
            const isArabic = language === 'ar';
            const heroSection = document.getElementById(isArabic ? 'hero-section-arabic' : 'hero-section');
            
            if (!heroSection || content.length === 0) return;

            // Find the main hero content (usually order 0 or first item)
            const mainHero = content.find(item => item.order === 0) || content[0];
            
            if (mainHero) {
                const titleElement = document.getElementById(isArabic ? 'hero-title-arabic' : 'hero-title');
                const subtitleElement = document.getElementById(isArabic ? 'hero-subtitle-arabic' : 'hero-subtitle');
                
                if (titleElement) titleElement.textContent = mainHero.title;
                if (subtitleElement) subtitleElement.textContent = mainHero.body;
            }
        }

        // Load and render slideshow content
        async loadSlideshowContent(language = 'en') {
            try {
                const slideshowContent = await this.fetchContent('slideshow', language);
                this.renderSlideshowContent(slideshowContent, language);
            } catch (error) {
                console.error('Error loading slideshow content:', error);
            }
        }

        // Render slideshow
        renderSlideshowContent(content, language) {
            const isArabic = language === 'ar';
            const slideshowContainer = document.getElementById(isArabic ? 'slideshow-content-arabic' : 'slideshow-content');
            const indicatorsContainer = document.getElementById(isArabic ? 'slideshow-indicators-arabic' : 'slideshow-indicators');
            
            if (!slideshowContainer || content.length === 0) return;

            // Sort content by order
            const sortedContent = content.sort((a, b) => a.order - b.order);

            // Generate slideshow HTML
            const slidesHTML = sortedContent.map((item, index) => {
                const activeClass = index === 0 ? 'active' : '';
                const linkHTML = item.metadata?.link ? 
                    `<a href="${item.metadata.link}" target="_blank">` : 
                    '<div>';
                const closeLinkHTML = item.metadata?.link ? '</a>' : '</div>';
                
                return `
                    <div class="carousel-item ${activeClass}">
                        ${linkHTML}
                            <img src="${item.imageUrl || 'https://placehold.co/1200x800'}" 
                                 class="d-block w-100" 
                                 alt="${this.escapeHtml(item.title)}">
                        ${closeLinkHTML}
                        <div class="carousel-caption d-none d-md-block">
                            <h5>${this.escapeHtml(item.title)}</h5>
                            ${item.body ? `<p>${this.escapeHtml(item.body)}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Generate indicators HTML
            const indicatorsHTML = sortedContent.map((_, index) => {
                const activeClass = index === 0 ? 'active' : '';
                const ariaCurrent = index === 0 ? 'aria-current="true"' : '';
                const target = isArabic ? '#slideshow-arabic' : '#slideshow';
                
                return `
                    <button type="button" 
                            data-bs-target="${target}" 
                            data-bs-slide-to="${index}" 
                            class="${activeClass}" 
                            ${ariaCurrent}
                            title="Slide ${index + 1}">
                    </button>
                `;
            }).join('');

            // Update DOM
            slideshowContainer.innerHTML = slidesHTML;
            if (indicatorsContainer) {
                indicatorsContainer.innerHTML = indicatorsHTML;
            }

            // Reinitialize Bootstrap carousel if needed
            this.reinitializeCarousel(isArabic);
        }

        // Reinitialize Bootstrap carousel
        reinitializeCarousel(isArabic) {
            const carouselId = isArabic ? '#slideshow-arabic' : '#slideshow';
            const carouselElement = document.querySelector(carouselId);
            
            if (carouselElement && window.bootstrap) {
                // Dispose existing carousel instance
                const existingCarousel = bootstrap.Carousel.getInstance(carouselElement);
                if (existingCarousel) {
                    existingCarousel.dispose();
                }
                
                // Create new carousel instance
                new bootstrap.Carousel(carouselElement, {
                    interval: 5000,
                    wrap: true
                });
            }
        }

        // Load all content for current language
        async loadAllContent(language = 'en') {
            this.currentLanguage = language;
            await Promise.all([
                this.loadHeroContent(language),
                this.loadSlideshowContent(language)
            ]);
        }

        // Escape HTML to prevent XSS
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    }

    // Initialize content manager
    const contentManager = new ContentManager();

    // Language switching functionality
    function switchLanguage(language) {
        contentManager.loadAllContent(language);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        // Load initial content
        contentManager.loadAllContent('en');
        
        // Setup language switching
        document.querySelectorAll('[id^="switch-to-arabic"]').forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                switchLanguage('ar');
            });
        });

        document.querySelectorAll('[id^="switch-to-english"]').forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                switchLanguage('en');
            });
        });
    });

    // Legacy functionality
    document.querySelectorAll('[id^="switch-to-arabic"]').forEach(element => {
        element.addEventListener('click', function() {
            document.getElementById('english-version').style.display = 'none';
            document.getElementById('arabic-version').style.display = 'block';
            document.querySelectorAll('.languageDropdown').forEach(button => button.innerText = 'Ar');
        });
    });

    document.querySelectorAll('[id^="switch-to-english"]').forEach(element => {
        element.addEventListener('click', function() {
            document.getElementById('arabic-version').style.display = 'none';
            document.getElementById('english-version').style.display = 'block';
            document.querySelectorAll('.languageDropdown').forEach(button => button.innerText = 'En');
        });
    });

    document.getElementById('hamburgerMenu').addEventListener('click', function() {
        var sidebar = document.getElementById('sidebar');
        var sidebarArabic = document.getElementById('sidebar-arabic');
        var icons = document.querySelectorAll('.hamburger-icon');
        if (sidebar) {
            sidebar.classList.toggle('active');
        }
        if (sidebarArabic) {
            sidebarArabic.classList.toggle('active');
        }
        icons.forEach(icon => {
            icon.classList.toggle('cross');
        });
    });

    // Toggle FAQ answers visibility when clicked
    document.querySelectorAll('.faq-question').forEach((question) => {
        question.addEventListener('click', () => {
            const faqItem = question.closest('.faq-item');
            if (faqItem) {
                faqItem.classList.toggle('active');
            }
        });
    });
    </script>
</body>
</html>